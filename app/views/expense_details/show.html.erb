<div class="container mt-4">
  <h1 class="h4 mb-4">Detalle del gasto común</h1>

  <div class="card shadow-sm">
    <div class="card-body p-0">

      <% detail = @expense_detail %>

      <table class="table table-hover mb-0">
        <thead class="table-light">
          <tr>
            <th style="width:30%">Detalle</th>
            <th style="width:20%">Monto total</th>
            <th>Vecinos asignados</th>
          </tr>
        </thead>

        <tbody>
          <tr>
            <td>
              <div class="p-2 border rounded bg-light">
                <strong><%= detail.detail %></strong>
              </div>
            </td>

            <td>
              <div class="p-2 border rounded bg-light">
                <%= number_to_currency(detail.amount, unit: "$") %>
              </div>
            </td>

            <td>
              <div class="p-2 border rounded bg-light">

                <% if detail.expense_details_neighbors.any? %>

                  <table class="table table-sm table-bordered mb-0 align-middle">
                    <thead class="table-light">
                      <tr>
                        <th>Nombre</th>
                        <th>Unidad</th>
                        <th>Monto adeudado</th>
                        <th>Estado</th>
                      </tr>
                    </thead>

                    <tbody>
                      <% detail.expense_details_neighbors.includes(:neighbor).each do |edn| %>
                        <tr>
                          <td><%= edn.neighbor.user.name %></td>
                          <td><%= edn.neighbor.unit %></td>
                          <td><%= number_to_currency(edn.amount_due) %></td>
                          <td>
                            <span class="badge <%= edn.paid ? 'bg-success' : 'bg-secondary' %>">
                              <%= edn.paid ? 'Pagado' : 'No pagado' %>
                            </span>
                          </td>
                        </tr>
                      <% end %>
                    </tbody>
                  </table>

                <% else %>
                  <span class="text-muted">No hay vecinos asignados a este detalle</span>
                <% end %>

              </div>
            </td>
          </tr>
        </tbody>
      </table>

    </div>
  </div>

  <div class="mt-3 d-flex gap-2">
    <%= link_to "Volver al gasto común",
        common_expense_path(detail.common_expense),
        class: "btn btn-secondary" %>

    <%= link_to "Editar detalle",
        edit_expense_detail_path(detail),
        class: "btn btn-outline-primary" %>

    <%= link_to "Eliminar detalle",
        expense_detail_path(detail),
        data: {
          turbo_method: :delete,
          turbo_confirm: "¿Estás seguro de eliminar este detalle?"
        },
        class: "btn btn-outline-danger ms-auto" %>
  </div>
</div>
