<div class="container py-4">
  <!-- Botón volver -->
  <div class="mb-3">
    <%= link_to community_common_spaces_path(@common_space.community),
        class: "text-primary fw-semibold" do %>
      <i class="fa-solid fa-arrow-left"></i> Volver a espacios comunes
    <% end %>
  </div>

  <!-- Header con icono -->
  <div class="text-center mb-4">
    <% name = @common_space.name.to_s.downcase %>
    <% icon = case true
              when name.include?("quincho")
                "fa-burger"
              when name.include?("sala") && name.include?("uso")
                "fa-users"
              when name.include?("cancha") || name.include?("tenis") || name.include?("tennis") || name.include?("deport")
                "fa-basketball"
              when name.include?("piscina") || name.include?("pileta")
                "fa-person-swimming"
              when name.include?("perro") || name.include?("gato") || name.include?("mascota") || name.include?("pet")
                "fa-paw"
              when name.include?("té") || name.include?("te ") || name.include?("mug") || name.include?("café")
                "fa-mug-saucer"
              when name.include?("juego") || name.include?("game")
                "fa-gamepad"
              when name.include?("gimnasio") || name.include?("gym")
                "fa-dumbbell"
              else
                "fa-building"
              end %>

    <div class="mx-auto mb-3"
         style="
           width: 100px;
           height: 100px;
           border-radius: 50%;
           background: #eef4ff;
           display:flex;
           align-items:center;
           justify-content:center;">
      <i class="fa-solid <%= icon %>" style="font-size: 2.8rem; color:#0743a1;"></i>
    </div>

    <h1 class="fw-bold text-primary"><%= @common_space.name %></h1>
    <p class="text-muted fs-5"><%= @common_space.description %></p>

    <!-- Disponibilidad -->
    <span class="badge <%= @common_space.is_available ? 'bg-success' : 'bg-danger' %> px-3 py-2 rounded-pill fs-6">
      <%= @common_space.is_available ? "Disponible" : "No disponible" %>
    </span>
  </div>

  <!-- Info: Precio + horarios -->
  <div class="row g-4 mb-5">

    <!-- PRECIO (SIMPLE, FORMATO EXACTO: $10000) -->
    <div class="col-md-4">
      <div class="p-4 shadow-sm border-0 rounded-4 bg-white">
        <h5 class="fw-bold text-primary mb-3">
          <i class="fa-solid fa-tag me-2"></i> Precio
        </h5>

        <p class="fs-5 fw-semibold text-dark">
          $<%= @common_space.price.to_i %>
        </p>
      </div>
    </div>

    <!-- HORARIOS -->
    <div class="col-md-8">
      <div class="p-4 shadow-sm border-0 rounded-4 bg-white">
        <h5 class="fw-bold text-primary mb-3">
          <i class="fa-solid fa-clock me-2"></i> Horarios
        </h5>

        <% week_hours = @usable_hours.group_by { |h| h.start.wday } %>

        <% week_hours.each do |wday, hours| %>
          <% ordered = hours.sort_by(&:start) %>

          <% first_hour = ordered.first.start %>
          <% last_hour  = ordered.last.end %>

          <p>
            <strong><%= I18n.t("date.day_names")[wday].capitalize %>:</strong>
            <%= first_hour.strftime("%-I:%M %P") %> - <%= last_hour.strftime("%-I:%M %P") %>
          </p>
        <% end %>

      </div>
    </div>

  </div>

  <!-- Acciones del administrador -->
  <% if policy(@common_space).update? %>
    <div class="d-flex justify-content-end gap-3 mb-4">

      <!-- Editar espacio -->
      <%= link_to edit_common_space_path(@common_space),
        class: "btn rounded-pill px-4 fw-semibold shadow-sm",
        style: "background:#3B5BDB; color:white; border:none;" do %>
        <i class="fa-solid fa-pen-to-square me-2"></i>
        Editar espacio
      <% end %>

      <!-- Eliminar espacio -->
      <%= link_to common_space_path(@common_space),
        data: { turbo_method: :delete,
                turbo_confirm: "¿Seguro que deseas eliminar este espacio común?" },
        class: "btn rounded-pill px-4 fw-semibold shadow-sm",
        style: "background:#0743A1; color:white; border:none;" do %>
        <i class="fa-solid fa-trash me-2"></i>
        Eliminar espacio
      <% end %>

    </div>
  <% end %>

  <!-- Acciones de reservas -->
  <div class="row mt-5">

    <!-- IZQUIERDA: Mis reservas del usuario -->
    <div class="col-md-6">
      <%= turbo_frame_tag "bookings_list" do %>
        <div class="p-4 shadow-sm border-0 rounded-4 bg-white mb-4">
          <h4 class="fw-bold text-primary mb-3">
            <i class="fa-solid fa-calendar-check me-2"></i>
            <%= current_user.administrator.present? ? "Reservas" : "Mis Reservas" %>
          </h4>

          <% if @bookings.any? %>
            <ul class="list-group list-group-flush mb-4">
              <% @bookings.each do |booking| %>
                <%= render "bookings/item", booking: booking %>
              <% end %>
            </ul>
          <% else %>
            <p class="text-muted fst-italic text-center mb-4">
              Aún no tienes reservas para este espacio.
            </p>
          <% end %>

        </div>
      <% end %>
    </div>

    <!-- DERECHA: Calendario + formulario -->
    <div class="col-md-6 d-flex justify-content-end">
      <div class="p-4 shadow-sm border-0 rounded-4 bg-white sticky-top"
        style="top: 100px; width: 90%; max-width: 420px;">
        <h4 class="fw-bold text-primary mb-3 text-start">Reservar ahora</h4>

        <%= render "booking_form", common_space: @common_space, booking: @booking %>

      </div>
    </div>

  </div>

</div>
