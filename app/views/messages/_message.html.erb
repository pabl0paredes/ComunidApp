<% own = message.user_id == current_user.id %>

<div id="<%= dom_id(message) %>"
    class="message-wrapper <%= own ? 'message-right' : 'message-left' %>">

  <div class="message-bubble <%= own ? 'my-bubble' : 'other-bubble' %> shadow-sm">

    <strong>
      <%= own ? "TÃº" : message.user.name %>:
    </strong>

    <%# Contenido del mensaje %>
    <% if message.content.present? %>
      <p class="mb-1"><%= message.content %></p>
    <% end %>

    <%# === ARCHIVOS ADJUNTOS === %>
    <% if message.files.attached? %>
      <div class="mt-2">
        <% message.files.each do |file| %>

          <% if file.image? %>
            <%# Miniatura para imÃ¡genes %>
            <%= link_to url_for(file), target: :_blank do %>
              <%= image_tag file.variant(resize_to_limit: [300, 300]).processed,
                    class: "img-thumbnail mb-2",
                    style: "max-width: 150px; height: auto;" %>
            <% end %>

          <% else %>
            <%# Link a PDF, Excel, Word, etc %>
            <div class="mb-1">
              ðŸ“Ž <%= link_to file.filename.to_s, url_for(file), target: :_blank %>
            </div>
          <% end %>

        <% end %>
      </div>
    <% end %>
    <%# === FIN ARCHIVOS === %>

    <span class="small <%= own ? 'text-light' : 'text-muted' %>">
      <%= message.created_at.strftime("%d/%m/%Y %H:%M") %>
    </span>

    <% if current_user.administrator.present? || own %>
      <div class="mt-1">
        <%= link_to "Eliminar",
            chat_message_path(message.chat, message),
            data: {
              turbo_method: :delete,
              turbo_confirm: "Â¿Seguro que querÃ©s eliminar este mensaje?"
            },
            class: "delete-message text-danger small" %>
      </div>
    <% end %>

  </div>

</div>
