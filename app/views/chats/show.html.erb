<div class="chat-container mt-3 chat-show-container">

  <div class="d-flex justify-content-between align-items-center mb-3">

    <%= link_to "← Volver a chats",
        community_chats_path(@chat.community),
        class: "text-decoration-none text-secondary small" %>

    <% if @show_chat.is_hidden? %>
      <%= button_to "Mostrar chat",
          show_chat_path(@show_chat),
          method: :patch,
          params: { show_chat: { is_hidden: false } },
          class: "btn btn-success" %>
    <% else %>
      <%= button_to "Ocultar este chat",
          show_chat_path(@show_chat),
          method: :patch,
          params: { show_chat: { is_hidden: true } },
          class: "chat-toggle-btn mb-3" %>
    <% end %>

  </div>

  <h2 class="chat-title"><%= @chat.name %></h2>
  <p class="text-muted chat-category">Categoría: <%= @chat.category %></p>
  <hr class="chat-divider">

  <%= turbo_frame_tag "messages_frame" do %>
    <div id="messages" class="messages-container">
      <% if @messages.any? %>
        <%= render @messages %>
      <% else %>
        <p class="text-muted">Todavía no hay mensajes.</p>
      <% end %>
    </div>
  <% end %>

  <div id="new_message_form" class="mt-3">
    <%= render "messages/form", chat: @chat, message: @message %>
  </div>
</div>

<script>
  function scrollToBottom() {
    const container = document.getElementById("messages");
    if (!container) return;

    requestAnimationFrame(() => {
      container.scrollTop = container.scrollHeight;
    });
  }

  document.addEventListener("turbo:load", scrollToBottom);

  const frame = document.getElementById("messages_frame");
  if (frame) {
    frame.addEventListener("turbo:frame-load", scrollToBottom);
  }
</script>
