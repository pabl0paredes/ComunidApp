<div class="container mt-3">
  <%= link_to "← Volver a chats", community_chats_path(@chat.community), class: "btn btn-secondary mb-3" %>

  <% if @show_chat.is_hidden? %>
    <%= button_to "Mostrar chat", show_chat_path(@show_chat),
        method: :patch,
        params: { show_chat: { is_hidden: false } },
        class: "btn btn-success mb-3" %>
  <% else %>
    <%= button_to "Ocultar chat", show_chat_path(@show_chat),
        method: :patch,
        params: { show_chat: { is_hidden: true } },
        class: "btn btn-warning mb-3" %>
  <% end %>

  <!-- Título del chat -->
  <h2><%= @chat.name %></h2>
  <p class="text-muted">Categoría: <%= @chat.category %></p>

  <hr>

  <!-- LISTA DE MENSAJES -->
  <h4>Mensajes</h4>

  <div id="messages" class="messages-list mb-4" style="max-height: 400px; overflow-y: auto; padding: 10px; background: #f8f9fa; border-radius: 8px;">

    <% if @messages.any? %>
      <%= render @messages %>
    <% else %>
      <p class="text-muted">Todavía no hay mensajes.</p>
    <% end %>

  </div>

  <hr>

  <!-- FORMULARIO DE NUEVO MENSAJE -->
  <h4>Nuevo mensaje</h4>

  <div id="new_message_form">
    <%= render "messages/form", chat: @chat, message: @message %>
  </div>


</div>

<script>
  document.addEventListener("turbo:load", scrollToBottom);
  document.addEventListener("DOMContentLoaded", scrollToBottom);

  function scrollToBottom() {
    const container = document.getElementById("messages");
    if (container) {
      container.scrollTop = container.scrollHeight;
    }
  }
</script>
