<div class="common-expenses-page container mt-4">

  <!-- Breadcrumb -->
  <div class="mb-3">
    <%= link_to "← Volver a gastos comunes",
        community_common_expenses_path(@common_expense.community),
        class: "text-primary text-decoration-none fw-semibold" %>
  </div>

  <!-- Header -->
  <div class="header-section">
    <h1 class="page-title h3 mb-0">
      Gasto común – <%= @common_expense.community.name %>
    </h1>
  </div>

  <!-- Resumen -->
  <div class="summary-box">
    <p class="mb-2">
      <strong>Total:</strong>
      <%= number_to_currency(@common_expense.total) %>
    </p>
    <p class="mb-0">
      <strong>Fecha:</strong>
      <%= l(@common_expense.date) %>
    </p>
  </div>

  <!-- Tabla de detalles -->
  <h2 class="h5 mb-3">Detalles del gasto</h2>

  <% if @expense_details.any? %>
    <table class="table table-hover align-middle details-table mb-3">

      <thead>
        <tr>
          <th>Concepto</th>
          <th>Monto</th>
          <th>Distribución</th>
          <th class="text-end">Acciones</th>
        </tr>
      </thead>

      <tbody>
        <% @expense_details.each do |detail| %>
          <tr>
            <td>
              <div class="cell-box"><%= detail.detail %></div>
            </td>

            <td>
              <div class="cell-box"><%= number_to_currency(detail.amount) %></div>
            </td>

            <td>
              <%= link_to expense_detail_path(detail),
                  class: "text-primary action-icon",
                  title: "Ver distribución" do %>
                <i class="bi bi-eye-fill"></i>
              <% end %>
            </td>

            <td class="text-end d-flex justify-content-end gap-2">

              <!-- EDITAR (icono azul) -->
              <%= link_to edit_expense_detail_path(detail),
                  class: "text-blue-600 action-icon",
                  title: "Editar detalle" do %>
                <i class="bi bi-pencil-fill"></i>
              <% end %>

              <!-- ELIMINAR (gama azulada, no rojo) -->
              <%= link_to expense_detail_path(detail),
                  data: { turbo_method: :delete, turbo_confirm: "¿Eliminar este detalle?" },
                  class: "text-primary action-icon",
                  title: "Eliminar detalle" do %>
                <i class="bi bi-trash-fill"></i>
              <% end %>

            </td>
          </tr>
        <% end %>
      </tbody>

    </table>
  <% else %>
    <p class="text-muted">No hay detalles para este gasto.</p>
  <% end %>

  <!-- Acciones finales -->
  <div class="footer-actions mt-4 d-flex justify-content-between align-items-center">

  <!-- Editar gasto -->
  <% if policy(@common_expense).edit? %>
    <%= link_to edit_common_expense_path(@common_expense),
        class: "btn btn-outline-primary" do %>
      <i class="bi bi-pencil-fill"></i> Editar gasto
    <% end %>
  <% end %>

  <!-- Volver a la lista (estilo unificado con los demás) -->
  <%= link_to community_common_expenses_path(@common_expense.community),
      class: "btn btn-outline-primary" do %>
    <i class="bi bi-arrow-left"></i> Volver a la lista
  <% end %>

  <!-- Eliminar gasto -->
  <% if policy(@common_expense).destroy? %>
    <%= link_to @common_expense,
        data: { turbo_method: :delete, turbo_confirm: "¿Eliminar este gasto común?" },
        class: "btn btn-outline-primary" do %>
      <i class="bi bi-trash-fill"></i> Eliminar gasto
    <% end %>
  <% end %>

</div>


</div>
